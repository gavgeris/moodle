<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Αναζήτηση επιμορφωτή/επιμορφούμενου</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css">

    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>

    <!-- Your custom CSS styles if needed -->
    <style>
        /* Add your custom styles here */
    </style>
</head>
<body>
<div class="container mt-12">
    <h2>Αναζήτηση επιμορφωτή/επιμορφούμενου</h2>

    <!-- Form to input the query parameter -->
    <form id="queryForm">
        <div class="form-group">
            <label for="surname">Επώνυμο:</label>
            <input type="text" class="form-control" id="surname" name="surname" required>
            <label for="name">Όνομα:</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>
        <button type="button" class="btn btn-primary" onclick="executeQueryEpimorfwth()">Αναζήτηση Επιμορφωτή</button>
        <button type="button" class="btn btn-primary" onclick="executeQueryEpimorfoumenou()">Αναζήτηση Επιμορφούμενου</button>
    </form>

    <!-- Display query results using DataTables -->
    <div class="mt-12">
        <table id="resultTable" class="table table-bordered table-striped">
            <thead>
            <!-- Adjust the headers based on your database table columns -->
            <tr>
                <th>Επώνυμο</th>
                <th>Όνομα</th>
                <th>email</th>
                <th>Χρονιά</th>
                <th>Σεμινάριο</th>
                <th>Ομάδα</th>
                <th>Έναρξη</th>
                <th>Λήξη</th>
                <th>Ημ/νια Υπογραφής</th>
                <th>Διάρκεια</th>
                <th>Βαθμολογία</th>
                <th>Βάση</th>
                <!-- Add more columns as needed -->
            </tr>
            </thead>
            <tbody>
            <!-- Results will be inserted here dynamically -->
            </tbody>
        </table>
    </div>
</div>

<script type="module">
    import Swal from 'sweetalert2'
    // Function to execute the query and update DataTable
</script>
<script>
    var apiUrl;
    function executeQuery() {
        // Perform AJAX request to fetch data from the server
        $.ajax({
            url: apiUrl,
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                // Clear existing table rows
                $('#resultTable tbody').empty();

                // Populate DataTable with new data
                for (var i = 0; i < data.length; i++) {
                    var rowData = data[i];
                    var rowHtml = '<tr>';
                    // Adjust the columns based on your database table structure
                    rowHtml += '<td>' + rowData.lastname + '</td>';
                    rowHtml += '<td>' + rowData.firstname + '</td>';
                    rowHtml += '<td>' + rowData.email + '</td>';
                    rowHtml += '<td>' + rowData.xronia + '</td>';
                    rowHtml += '<td>' + rowData.course + '</td>';
                    rowHtml += '<td>' + rowData.groupname + '</td>';
                    rowHtml += '<td>' + rowData.start_date + '</td>';
                    rowHtml += '<td>' + rowData.end_date + '</td>';
                    rowHtml += '<td>' + rowData.sign_date + '</td>';
                    rowHtml += '<td>' + rowData.duration + '</td>';
                    rowHtml += '<td>' + rowData.finalgrade + '</td>';
                    rowHtml += '<td>' + rowData.gradepass + '</td>';
                    // Add more columns as needed
                    rowHtml += '</tr>';
                    $('#resultTable tbody').append(rowHtml);
                }

                // Initialize DataTable
                $('#resultTable').DataTable();
            },
            error: function (error) {
                console.log('Error:', error);
                Swal.fire({
                    title: 'Error!',
                    text: 'Πρέπει πρώτα να συνδεθείτε με δικαιώματα Administrator στο Moodle',
                    icon: 'error',
                    confirmButtonText: 'OK'
                })
            }
        });
    }
    function executeQueryEpimorfwth() {
        var surnameParam = $('#surname').val();
        var nameParam = $('#name').val();

        apiUrl = 'api/query_epimorfwths.php?surname=' + surnameParam + "&name=" + nameParam;

        executeQuery();
    }
    function executeQueryEpimorfoumenou() {
        var surnameParam = $('#surname').val();
        var nameParam = $('#name').val();

        apiUrl = 'api/query_epimorfoumenos.php?surname=' + surnameParam + "&name=" + nameParam;

        executeQuery();
    }
</script>

</body>
</html>
